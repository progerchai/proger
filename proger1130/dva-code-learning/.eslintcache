[{"/Users/aiyouwei/Documents/proger/progerchai/proger1130/dva-code-learning/src/index.jsx":"1","/Users/aiyouwei/Documents/proger/progerchai/proger1130/dva-code-learning/src/dva/index.jsx":"2","/Users/aiyouwei/Documents/proger/progerchai/proger1130/dva-code-learning/src/dva/router.jsx":"3"},{"size":2029,"mtime":1607964536962,"results":"4","hashOfConfig":"5"},{"size":3018,"mtime":1607964437880,"results":"6","hashOfConfig":"5"},{"size":46,"mtime":1607964230383,"results":"7","hashOfConfig":"5"},{"filePath":"8","messages":"9","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},"s3g3ch",{"filePath":"10","messages":"11","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"12"},{"filePath":"13","messages":"14","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"/Users/aiyouwei/Documents/proger/progerchai/proger1130/dva-code-learning/src/index.jsx",["15"],"/Users/aiyouwei/Documents/proger/progerchai/proger1130/dva-code-learning/src/dva/index.jsx",["16"],"import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { createBrowserHistory } from \"history\";\nimport { applyMiddleware, combineReducers, createStore } from \"redux\";\nimport { Provider, connect } from \"react-redux\";\nimport createSagaMiddleware from \"redux-saga\";\nimport * as sagaEffects from \"redux-saga/effects\";\n\nexport { connect };\nexport default function (opts = {}) {\n  let history = opts.history || createBrowserHistory();\n  let app = {\n    _models: [],\n    model,\n    _router: null,\n    router,\n    start,\n  };\n  function model(model) {\n    let prefixModel = prefixNamespace(model);\n    app._models.push(prefixModel);\n  }\n  function router(routerConfig) {\n    app._router = routerConfig;\n  }\n  function start(container) {\n    let reducers = getReducers(app);\n    let sagaMiddleware = createSagaMiddleware(); // 新建middleware\n    app._store = createStore(reducers, applyMiddleware(sagaMiddleware)); //插入middleware\n    function* rootSaga() {\n      const { takeEvery } = sagaEffects;\n      for (const model of app._models) {\n        const effects = model.effects;\n        for (const key in effects) {\n          //遍历effects\n          yield takeEvery(`${model.namespace}/${key}`, function* (action) {\n            console.log(\"执行了saga\");\n            yield effects[key](action, sagaEffects);\n          });\n        }\n      }\n    }\n    sagaMiddleware.run(rootSaga);\n    // subscriptions\n    for (const model of app._models) {\n      if (model.subscriptions) {\n        for (const key in model.subscriptions) {\n          //遍历跑一遍subscriptions\n          let sub = model.subscriptions[key];\n          sub({ history, dispatch: app._store.dispatch });\n        }\n      }\n    }\n    ReactDOM.render(\n      <Provider store={app._store}>{app._router({ history })}</Provider>,\n      document.querySelector(container)\n    );\n  }\n\n  return app;\n}\n\n/**\n * 将所有的model 的reducer 以namespace 为key 整合成新的reducers\n * {\n * namespace1:function(state,action){},\n * namespace2:function(state,action){}\n * }\n * @param {*} app\n */\nfunction getReducers(app) {\n  let reducers = {}; //用来合并,会传递给combineReducers\n  for (const model of app._models) {\n    // 这里的state 是这个 model 对应的分状态\n    reducers[model.namespace] = function (state = model.state || {}, action) {\n      let model_reducers = model[\"reducers\"] || {}; // 拿到一个model 的所有reducer\n      let reducer = model_reducers[action.type]; // model_reducers['counter/add'] =>  model_reducers['add']\n      if (reducer) {\n        return reducer(state, action);\n      }\n      return state;\n    };\n  }\n  return combineReducers(reducers);\n}\n\n/**\n * 把reducer 对象的属性名 加上 `namespace`\n * @param {*} m\n */\nfunction prefixNamespace(m) {\n  let reducers = m.reducers;\n  m.reducer = Object.keys(reducers).reduce((memo, key) => {\n    let newKey = `${m.namespace}/${key}`;\n    memo[newKey] = reducers[key];\n    return memo;\n  }, {});\n\n  // 同样可以对effect做prefix操作\n\n  return m;\n}\n","/Users/aiyouwei/Documents/proger/progerchai/proger1130/dva-code-learning/src/dva/router.jsx",[],{"ruleId":"17","severity":1,"message":"18","line":5,"column":8,"nodeType":"19","messageId":"20","endLine":5,"endColumn":11},{"ruleId":"21","severity":1,"message":"22","line":10,"column":1,"nodeType":"23","endLine":61,"endColumn":2},"no-unused-vars","'key' is defined but never used.","Identifier","unusedVar","import/no-anonymous-default-export","Unexpected default export of anonymous function","ExportDefaultDeclaration"]